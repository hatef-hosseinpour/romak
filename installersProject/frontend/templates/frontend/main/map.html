<!DOCTYPE html>
<html lang="fa" dir="rtl">
{% load static %}
{% block headcontent %}
{% include 'head.html' with title="Installers App| Dashboard" %}
{% endblock %}
<!-- /header content -->

<body class="nav-md">
    <div class="container body">
        <div class="main_container">
            <div class="col-md-3 left_col hidden-print">
                <div class="left_col scroll-view">
                    {% include 'navbar.html'%}
                </div>
            </div>

            <!-- top navigation -->
            <div class="top_nav hidden-print">
                <div class="nav_menu">
                    <nav>
                        <div class="nav toggle">
                            <a id="menu_toggle"><i class="fa fa-bars"></i></a>
                        </div>

                        <ul class="nav navbar-nav navbar-right">
                            <li class="">
                                <a href="javascript:;" class="user-profile dropdown-toggle" data-toggle="dropdown"
                                    aria-expanded="false">
                                    <img id="user-profile" alt="">{{request.session.username}}<span
                                        class=" fa fa-angle-down"></span>
                                </a>
                                <ul class="dropdown-menu dropdown-usermenu pull-right">
                            </li>
                            <li><a href="/profile/"><i class="fa fa-user pull-right"></i>
                                    پروفایل</a></li>
                            <li><a href="/change-password/"><i class="fa fa-lock pull-right"></i>
                                    تغییر رمزعبور</a></li>
                            <hr>
                            <li><a id="logout" onclick="logout()"><i class="fa fa-sign-out pull-right"></i>
                                    خروج</a></li>
                        </ul>
                        </li>
                        </ul>
                    </nav>
                </div>
            </div>
            <!-- /top navigation -->
            <!-- /header content -->

            <!-- page content -->
            <div class="right_col" role="main">
                <div class="">
                    <div class="page-title">
                        <div class="title_left">
                            <h3>صفحه ساده</h3>
                        </div>

                        <div class="title_right">
                            <div class="col-md-5 col-sm-5 col-xs-12 form-group pull-right top_search">
                                <div class="input-group">
                                    <input type="text" class="form-control" placeholder="جست و جو برای...">
                                    <span class="input-group-btn">
                                        <button class="btn btn-default" type="button"><i
                                                class="fa fa-search"></i></button>
                                    </span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="clearfix"></div>

                    <div class="row">
                        <div class="col-md-12 col-sm-12 col-xs-12">
                            <div class="x_panel">
                                <div class="x_title">
                                    <h2>صفحه ساده</h2>

                                    <div class="clearfix"></div>
                                </div>
                                <div class="col-md-12 col-sm-12 col-xs-12">

                                    <div class="x_title">

                                        <div class="col-md-3">

                                        </div>
                                        <div class="col-md-3">
                                            <label for="heard">شنیده ایم با <span class="required">*</span>:</label>
                                            <select id="heard" class="form-control" required>
                                                <option hidden></option>
                                                <option value="press">اخبار</option>
                                                <option value="net">اینترنت</option>
                                                <option value="mouth">دهان به دهان</option>
                                            </select>
                                        </div>
                                        <div class="col-md-3">
                                            <label for="heard">شنیده ایم با <span class="required">*</span>:</label>
                                            <select id="heard" class="form-control" required>
                                                <option hidden></option>
                                                <option value="press">اخبار</option>
                                                <option value="net">اینترنت</option>
                                                <option value="mouth">دهان به دهان</option>
                                            </select>
                                        </div>
                                        <div class="clearfix"></div>
                                    </div>

                                    <div class="x_content">



                                        <div id="maps" class="jumbotron" style="height: 700px;"> </div>
                                    </div>

                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- /page content -->

            <!-- /page content -->

            <!-- footer content -->
            <footer class="hidden-print">
                <div class="pull-left">
                </div>
                <div class="clearfix"></div>
            </footer>
            <!-- /footer content -->
        </div>
    </div>
    <div id="lock_screen">
        <table>
            <tr>
                <td>
                    <div class="clock"></div>
                    <span class="unlock">
                        <span class="fa-stack fa-5x">
                            <i class="fa fa-square-o fa-stack-2x fa-inverse"></i>
                            <i id="icon_lock" class="fa fa-lock fa-stack-1x fa-inverse"></i>
                        </span>
                    </span>
                </td>
            </tr>
        </table>
    </div>
    {% include 'scripts.html' %}



    <script>
        $('select').select2();
        var map = L.map('maps').setView([35.6892, 51.3890], 6);

        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '© OpenStreetMap contributors <br> Romak system'
        }).addTo(map);

        var locationIcon = L.icon({
            iconUrl: 'https://img.icons8.com/external-flaticons-flat-flat-icons/64/000000/external-factory-factory-flaticons-flat-flat-icons-2.png',
            iconSize: [64, 64],
            iconAnchor: [16, 32],
        });


        // Create a custom control
        var myLocationControl = L.control({
            position: 'topright' // Set the position of the control (topright, topleft, bottomright, bottomleft)
        });

        // Add content to the control (e.g., a button with your location icon)
        myLocationControl.onAdd = function (map) {
            var div = L.DomUtil.create('div', 'leaflet-bar leaflet-control');
            var button = $('<button>', {
                id: 'location-button',
            });
            var img = $('<img>', {
                src: 'https://img.icons8.com/ios-filled/50/center-direction.png', // Replace with the actual path to your location icon image
                alt: 'Location Icon',
                width: '25px',
                height: '25px',
            });

            button.append(img);
            div.appendChild(button[0]);

            $(div).on('click', '#location-button', function () {

                if ("geolocation" in navigator) {
                    navigator.geolocation.getCurrentPosition(function (position) {
                        var userLocation = [position.coords.latitude, position.coords.longitude];
                        map.setView(userLocation, 16);
                        locationMarker.setLatLng(userLocation);
                    }, function (error) {
                        console.error("Error getting user location:", error);
                    });
                } else {
                    alert("Geolocation is not available in your browser.");
                }
            });

            return div;
        };

        myLocationControl.addTo(map);


        // Example engine room data
        var engineRooms = [
            { name: 'خوابگاه', latlng: [35.70321924120019, 51.40270551339944], details: 'Details about ER 1' },
            { name: 'تست', latlng: [37.46943082390814, 52.361716489683374], details: 'Details about ER 2' },
            { name: '2تست', latlng: [37.62701460081053, 53.90992339277583], details: 'Details about ER 3' }
            // Add more engine rooms...
        ];
        // Add markers for each engine room
        engineRooms.forEach(function (room) {
            $.ajax({
                url: `https://nominatim.openstreetmap.org/reverse?format=json&lat=${room.latlng[0]}&lon=${room.latlng[1]}`,
                dataType: 'json',
                success: function (data) {
                    var cityName = data.address.city || data.address.town || data.address.village || "Unknown City";

                    var marker = L.marker(room.latlng, {
                        icon: locationIcon,
                    }
                    ).addTo(map);
                    marker.bindPopup(`<a href="https://google.com"><h5>${cityName}</h5></a><br>${room.details}`);
                }
            });
        });

        // Add event listener for marker clicks
        map.on('popupopen', function (e) {
            var marker = e.popup._source;
            // Handle marker click, show details to admin user
        });
    </script>
</body>

</html>