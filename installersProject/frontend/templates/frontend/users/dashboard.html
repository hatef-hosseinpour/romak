<!DOCTYPE html>
<html lang="fa" dir="rtl">
{% load static %}
{% block headcontent %}
{% include 'head.html' with title="Installers App| Dashboard" %}
{% endblock %}
<!-- /header content -->
<style>
    p {
        font-size: 15px;
    }
</style>

<body class="nav-md">
    <div class="container body">
        <div class="main_container">
            <div class="col-md-3 left_col hidden-print">
                <div class="left_col scroll-view">
                    {% include 'navbar.html'%}
                </div>
            </div>

            <!-- top navigation -->
            <div class="top_nav hidden-print">
                <div class="nav_menu">
                    <nav>
                        <div class="nav toggle">
                            <a id="menu_toggle"><i class="fa fa-bars"></i></a>
                        </div>

                        <ul class="nav navbar-nav navbar-right">
                            <li class="">
                                <a href="javascript:;" class="user-profile dropdown-toggle" data-toggle="dropdown"
                                    aria-expanded="false">
                                    {{request.session.username}} <span class=" fa fa-angle-down"></span>
                                </a>
                                <ul class="dropdown-menu dropdown-usermenu pull-right">
                            </li>
                            <li><a href="/dashboard/"><i class="fa fa-user pull-right"></i>
                                    پروفایل</a></li>
                            <li><a href="/reset_password/{{request.session.user_id}}"><i
                                        class="fa fa-lock pull-right"></i>
                                    تغییر رمزعبور</a></li>
                            <hr>
                            <li><a id="logout" onclick="logout()"><i class="fa fa-sign-out pull-right"></i>
                                    خروج</a></li>
                        </ul>
                        </li>
                        </ul>
                    </nav>
                </div>
            </div>
            <!-- /top navigation -->
            <!-- /header content -->

            <!-- page content -->
            <div class="right_col" role="main">
                <div class="">
                    <div class="page-title">
                        <div class="title_left">
                            <h3>پروفایل کاربر</h3>
                        </div>

                        <div class="title_right">
                            <div class="col-md-5 col-sm-5 col-xs-12 form-group pull-right top_search">
                                <div class="input-group">

                                    <span class="input-group-btn">

                                    </span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="clearfix"></div>

                    <div class="row">
                        <div class="col-md-12 col-sm-12 col-xs-12">
                            <div class="x_panel">
                                <div class="x_title">

                                    <ul class="nav navbar-right panel_toolbox">
                                        <li><a class="collapse-link"><i class="fa fa-chevron-up"></i></a>
                                        </li>

                                        <li><a class="close-link"><i class="fa fa-close"></i></a>
                                        </li>
                                    </ul>
                                    <div class="clearfix"></div>
                                </div>
                                <div class="x_content">

                                    <div class="row">


                                        <section style="background-color: #eee;">
                                            <div class="container py-5">
                                                <div class="row">
                                                    <div class="col" style="
                                                    margin-top: 20px;
                                                ">

                                                    </div>
                                                </div>

                                                <div class="row">
                                                    <div class="col-lg-4">
                                                        <div class="card mb-4">
                                                            <div class="card-body text-center">
                                                                <img id="profile" src="" alt="avatar"
                                                                    class="rounded-circle img-fluid"
                                                                    style="width: 150px;">
                                                                <h5 class="my-3" id="username">
                                                                    {{request.session.username}}</h5>
                                                                {% if request.session.is_admin %}
                                                                <p class="text-muted mb-1" id="role">سرپرست</p>
                                                                {% elif request.session.is_staff %}
                                                                <p class="text-muted mb-1" id="role">مدیر</p>
                                                                {% else %}
                                                                <p class="text-muted mb-1" id="role">نصاب</p>
                                                                {% endif %}
                                                                <div class="d-flex justify-content-center mb-2" style="
                                                                  margin-top: 55px;
                                                                    margin-bottom: 41px;">
                                                                    <a href="/edit-profile/"
                                                                        class="btn btn-primary btn-block" style="
                                                                        margin-top: 10px;
                                                                    ">ویرایش</a>

                                                                </div>
                                                            </div>
                                                        </div>


                                                        <div class="clearfix"></div>
                                                        <div class="card col-md-12">
                                                            <div class="card-body p-0">
                                                                <div class="col-md-12">
                                                                    <div class="card mb-4 mb-md-0">
                                                                        <div class="card-body" id="enginerooms_user">
                                                                            <p class="mb-4"><span
                                                                                    class="text-primary font-italic me-1">
                                                                                    </span>

                                                                            </p>
                                                                            <br>




                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="col-lg-8">
                                                        <div class="card mb-4">
                                                            <div class="card-body">
                                                                <div class="row">
                                                                    <div class="col-sm-3">
                                                                        <p class="mb-0 font-weight-bold">نام</p>
                                                                    </div>
                                                                    <div class="col-sm-9">
                                                                        <p class="text-muted mb-0" id="name"></p>
                                                                    </div>
                                                                </div>
                                                                <hr>
                                                                <div class="row">
                                                                    <div class="col-sm-3">
                                                                        <p class="mb-0">ایمیل</p>
                                                                    </div>
                                                                    <div class="col-sm-9">
                                                                        <p class="text-muted mb-0" id="email"> </p>
                                                                    </div>
                                                                </div>
                                                                <hr>
                                                                <div class="row">
                                                                    <div class="col-sm-3">
                                                                        <p class="mb-0">شماره همراه</p>
                                                                    </div>
                                                                    <div class="col-sm-9">
                                                                        <p class="text-muted mb-0" id="phone-number">
                                                                        </p>
                                                                    </div>
                                                                </div>
                                                                <hr>
                                                                <div class="row">
                                                                    <div class="col-sm-3">
                                                                        <p class="mb-0">وضعیت</p>
                                                                    </div>
                                                                    <div class="col-sm-9">
                                                                        <p class="text-muted mb-0" id="is-active"></p>
                                                                    </div>
                                                                </div>
                                                                <hr>

                                                            </div>
                                                        </div>

                                                    </div>
                                                </div>
                                            </div>
                                        </section>


                                    </div>

                                    <div class="row"></div>


                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- /page content -->

            <!-- /page content -->

            <!-- footer content -->

            <!-- /footer content -->
        </div>
    </div>
    <div id="lock_screen">
        <table>
            <tr>
                <td>
                    <div class="clock"></div>
                    <span class="unlock">
                        <span class="fa-stack fa-5x">
                            <i class="fa fa-square-o fa-stack-2x fa-inverse"></i>
                            <i id="icon_lock" class="fa fa-lock fa-stack-1x fa-inverse"></i>
                        </span>
                    </span>
                </td>
            </tr>
        </table>
    </div>
    </section>
    {% include 'scripts.html' %}

    <script>
        let user_id = "{{request.session.user_id}}"
        let p_engineroom = '<p class="mb-1" style="font-size: .77rem;" id="engineroom"></p>';

        $(document).ready(function () {
            $.ajax({
                type: "GET",
                url: `/api/users/${user_id}/`,
                success: function (response) {
                    $('#name').text(response.first_name || response.last_name ? response.first_name + ' ' + response.last_name : '--');
                    $("#email").text(response.email || '--')
                    $("#is-active").text(response.is_active ? 'فعال' : 'غیرفعال')
                    $("#username").text(response.username);

                }
            });
            $.ajax({
                type: "GET",
                url: `/api/users-profile/${user_id}/`,
                success: function (response) {
                    $("#phone-number").text(response.phone_number || '--')
                    $('#profile').attr('src', response.profile_image)
                    console.log(response.profile_image);

                },
                error: function () {
                    console.log('Failed to retrieve profile data');
                }
            });
            // $.ajax({
            //     type: "GET",
            //     url: '/api/enginroom/get_enginerooms_by_user/',

            //     success: function (response) {
            //         response.forEach(function (engineroom) {
                        
            //             var progressWidth = (engineroom.step + 1) * 25;
            //             $('#enginerooms_user').append(`<p class="mb-1" id="engineroom">${engineroom.enginroom_name}</p>
            //                         <div class="clearfix"></div>
            //         <div class="progress rounded"
            //             style = "height: 6px;" >
            //             <div class="progress-bar" role="progressbar"
            //                 style="width: ${progressWidth}%" aria-valuenow="5"
            //                 aria-valuemin="0" aria-valuemax="100">
                            
                            
            //         </div>
                    
            //         </div >
            //         <div style="display:${ engineroom.rejection_note == null ? 'none' : 'block'  }">
            //                     <strong>علت رد شدن <br>
            //                     ${engineroom.rejection_note}
                            
            //                     </strong>
            //                 </div>
            //                 </div>
            //                 <hr>
            //         `)

            //         });

            //     }
            // });
        });


    </script>