{% extends 'main.html'%}
{% load static %}
{% block headcontent %}
{% include 'head.html' with title="Installers App| User Profile" %}
{% endblock %}
{% block content %}
<br>
<a class="btn btn-primary rtl-txt" style="font-family: vazir" id="create-user-btn" href="/create-user/">افزودن کاربر</a>
<br>
<table class="table table-hover rtl-txt " id="users-list">
    <thead>
        <tr>
            <th scope="col">تصویر پروفایل</th>
            <th scope="col">نام</th>
            <th scope="col">نام کاربری</th>
            <th scope="col">نقش کاربری</th>
            <th scope="col">وضعیت</th>
            <th scope="col"></th>
        </tr>
    </thead>
    <tbody>

    </tbody>
</table>
<script>
    $(document).ready(function () {
        function listOfUsers(resp) {
            const tableBody = $('#users-list tbody')
            tableBody.empty();
            resp.forEach(function (obj) {
                const profileImage = obj.profile_image
                    ? `<img src=${obj.profile_image} alt="profile image" class="thumbnail" height="100px" width="100px"> ` : '';

                const row = ` 
                <tr>
                    <td>${profileImage}</td>
                    <td>${obj.first_name} ${obj.last_name}</td>
                    <td>${obj.username}</td>
                    <td> ${obj.is_superuser ? 'ادمین' : 'نصاب'}</td>
                    <td>${obj.is_active ? 'فعال' : 'غیرفعال'}</td>
                    <td>
                        <a class="btn btn-sm btn-danger" href="/delete-user/${obj.id}"><img width="20" height="20" src="{% static 'icons/icons8-trash-24.png' %}" alt="trash"/></a>

                        <a class="btn btn-sm btn-warning" href="/update-user/${obj.id}"><img width="20" height="20" src="{% static 'icons/icons8-pencil-50.png' %}" alt="pencil"/></a>
                        <a class="btn btn-sm btn-success" href="/user-details/${obj.id}"><img width="20" height="20" src="{% static 'icons/icons8-eye-50.png' %}" alt="eye"/></a>
                    </td>
                </tr>
                `;
                tableBody.append(row);
            });
        }
        $.ajax({
            type: "GET",
            url: "/api/users-list/",
            success: function (response) {
                listOfUsers(response)
            },
            error: function (error) {
                console.error('Error fetching user details:', error.responseJSON);
            }
        });
    });
</script>
{% endblock content %}